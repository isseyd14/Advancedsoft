# Build your Java project and run tests with Apache Maven.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- issey release2

pool:
  vmImage: ubuntu-latest

steps:
- task: JavaToolInstaller@0
  inputs:
    versionSpec:  '17'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'
- task: Maven@3
  inputs:
    mavenPomFile: 'Web/WEB-INF/Advancedsoft/pom.xml'
    mavenOptions: '-Xmx3072m'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '17'
    jdkArchitectureOption: 'x64'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    goals: 'package'
# Maven

- stage: 'Deploy'
  displayName: 'deploy web app'
  dependsOn: Build
  jobs:
  - deployment: 
    pool:
      vmImage: 'ubuntu-20.04'
    environment: dev
    variables:
    - group: Release
    strategy:
      runOnce:
        deploy:
          steps:
          - download: current
            artifact: drop
          - task: azureWebApp@1
            displayName: 'azure deploy service'
            inputs:
              azureSubscription: 'Azure for Students (3c01d404-c8eb-4faa-b755-f585f940e4f9)'
              appName: '$asdbank'
              package: '$(Pipeline.Workspace)/drop/$(buildconfiguration)/*.zip'